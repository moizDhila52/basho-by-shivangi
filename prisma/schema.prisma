generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Address {
  id        String   @id @default(uuid())
  userId    String
  street    String
  city      String
  state     String
  pincode   String
  country   String   @default("India")
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Cart {
  id        String     @id @default(uuid())
  userId    String     @unique
  sessionId String?    @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  CartItem  CartItem[]
  User      User[]

  @@index([sessionId])
  @@index([userId])
}

model CartItem {
  id        String   @id @default(uuid())
  cartId    String
  productId String
  quantity  Int      @default(1)
  price     Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Cart      Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  Product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([cartId, productId])
  @@index([cartId])
  @@index([productId])
}

model Category {
  id          String    @id @default(uuid())
  name        String
  slug        String    @unique
  description String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  Product     Product[]

  @@index([slug])
}

model Order {
  id              String      @id @default(uuid())
  orderNumber     String?     @unique
  userId          String?
  customerName    String?
  customerEmail   String?
  address         Json
  total           Float
  status          OrderStatus @default(PENDING)
  paymentId       String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  adminNotes      String?
  customerNotes   String?
  customerPhone   String?
  deliveredAt     DateTime?
  discount        Float       @default(0)
  paymentStatus   String?
  razorpayOrderId String?
  shippedAt       DateTime?
  shippingCost    Float       @default(0)
  subtotal        Float
  tax             Float       @default(0)
  trackingNumber  String?
  customerGst     String?
  User            User?       @relation(fields: [userId], references: [id])
  OrderItem       OrderItem[]

  @@index([createdAt])
  @@index([status])
  @@index([userId])
}

model OrderItem {
  id           String   @id @default(uuid())
  orderId      String
  productId    String
  quantity     Int
  price        Float
  createdAt    DateTime @default(now())
  productImage String
  productName  String
  productSlug  String
  Order        Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  Product      Product  @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
}

model CustomOrder {
  id                   String            @id @default(uuid())
  userId               String?
  productType          String
  quantity             Int               @default(1)
  material             String
  glaze                String?
  dimensions           Json              // { height: number, width: number, depth: number }
  colorPreferences     String?
  specialRequirements  String?
  deadline             String?
  budgetRange          String?
  contactName          String
  contactEmail         String
  contactPhone         String?
  notes                String?
  status               CustomOrderStatus @default(PENDING)
  estimatedPrice       Float?
  actualPrice          Float?
  files                String[]          // Array of file URLs
  adminNotes           String?
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt
  User                 User?             @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

enum CustomOrderStatus {
  PENDING
  REVIEWED
  QUOTED
  APPROVED
  IN_PROGRESS
  COMPLETED
  SHIPPED
  CANCELLED
}

model Product {
  id              String         @id @default(uuid())
  name            String
  slug            String         @unique
  description     String
  price           Float
  stock           Int            @default(0)
  images          String[]
  isFeatured      Boolean        @default(false)
  categoryId      String
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  care            String?
  color           String?
  dimensions      String?
  features        String[]
  inStock         Boolean        @default(true)
  isBestseller    Boolean        @default(false)
  isNew           Boolean        @default(false)
  leadTime        String?
  material        String?
  metaDescription String?
  metaTitle       String?
  originalPrice   Float?
  weight          Float          @default(0.5)
  CartItem        CartItem[]
  OrderItem       OrderItem[]
  Category        Category       @relation(fields: [categoryId], references: [id])
  Review          Review[]
  testimonials    Testimonial[]
  WishlistItem    WishlistItem[]

  @@index([categoryId])
  @@index([isBestseller])
  @@index([isFeatured])
  @@index([isNew])
  @@index([slug])
}

model Review {
  id         String   @id @default(uuid())
  rating     Float
  comment    String?
  productId  String
  userId     String
  isVerified Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  Product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([rating])
  @@index([userId])
}

model User {
  id           String         @id @default(uuid())
  email        String         @unique
  name         String?
  role         Role           @default(CUSTOMER)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  cartId       String?
  gstNumber    String?
  otp          String?
  otpExpiresAt DateTime?
  passwordHash String?
  phone        String?
  isSubscribed   Boolean        @default(false)
  Address      Address[]
  CustomOrder  CustomOrder[]
  Order        Order[]
  CustomOrder  CustomOrder[]
  Review       Review[]
  Cart         Cart?          @relation(fields: [cartId], references: [id])
  WishlistItem WishlistItem[]
}

model WishlistItem {
  id        String   @id @default(uuid())
  userId    String
  productId String
  createdAt DateTime @default(now())
  Product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([productId])
  @@index([userId])
}

model Workshop {
  id              String            @id @default(uuid())
  title           String
  slug            String            @unique
  description     String
  price           Float
  image           String
  gallery         String[]
  duration        String
  maxStudents     Int
  location        String
  language        String
  level           String
  instructorName  String
  instructorRole  String
  instructorImage String
  status          WorkshopStatus    @default(UPCOMING)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  instructorBio   String?
  testimonials    Testimonial[]
  WorkshopSession WorkshopSession[]

  @@index([slug])
  @@index([status])
}

model WorkshopRegistration {
  id              String          @id @default(uuid())
  customerName    String
  customerEmail   String
  amountPaid      Float
  sessionId       String
  createdAt       DateTime        @default(now())
  customerPhone   String?
  paymentId       String?
  paymentStatus   String?         @default("pending")
  razorpayOrderId String?
  WorkshopSession WorkshopSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([customerEmail])
  @@index([sessionId])
}

model WorkshopSession {
  id                   String                 @id @default(uuid())
  date                 DateTime
  time                 String
  spotsTotal           Int
  spotsBooked          Int                    @default(0)
  workshopId           String
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  WorkshopRegistration WorkshopRegistration[]
  Workshop             Workshop               @relation(fields: [workshopId], references: [id], onDelete: Cascade)

  @@index([date])
  @@index([workshopId])
}

model Event {
  id               String        @id @default(uuid())
  title            String
  slug             String        @unique
  description      String
  shortDescription String?
  type             EventType
  location         String
  address          String?
  startDate        DateTime
  endDate          DateTime
  image            String
  gallery          String[]
  status           EventStatus   @default(UPCOMING)
  featured         Boolean       @default(false)
  isActive         Boolean       @default(true)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  galleryItems     GalleryItem[]
  Testimonial      Testimonial[]

  @@index([slug])
  @@index([startDate])
  @@index([status])
  @@index([featured])
}

model GalleryItem {
  id          String          @id @default(uuid())
  title       String
  description String?
  image       String
  category    GalleryCategory
  featured    Boolean         @default(false)
  order       Int             @default(0)
  eventId     String?
  isActive    Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  Event       Event?          @relation(fields: [eventId], references: [id])

  @@index([category])
  @@index([featured])
  @@index([order])
}

model Testimonial {
  id           String    @id @default(uuid())
  customerName String
  customerRole String?
  content      String
  rating       Float     @default(5)
  image        String?
  videoUrl     String?
  featured     Boolean   @default(false)
  approved     Boolean   @default(false)
  source       String?
  productId    String?
  workshopId   String?
  eventId      String?
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  Event        Event?    @relation(fields: [eventId], references: [id])
  Product      Product?  @relation(fields: [productId], references: [id])
  Workshop     Workshop? @relation(fields: [workshopId], references: [id])

  @@index([approved])
  @@index([featured])
  @@index([productId])
  @@index([workshopId])
  @@index([eventId])
}

model CorporateInquiry {
  id          String        @id @default(uuid())
  companyName String
  contactName String
  email       String
  phone       String?
  companySize String?
  interest    String[]
  message     String
  status      InquiryStatus @default(PENDING)
  notes       String?
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([status])
  @@index([createdAt])
}

model CustomOrder {
  id                  String            @id
  userId              String?
  productType         String
  quantity            Int               @default(1)
  material            String
  glaze               String?
  dimensions          Json
  colorPreferences    String?
  specialRequirements String?
  deadline            String?
  budgetRange         String?
  contactName         String
  contactEmail        String
  contactPhone        String?
  notes               String?
  status              CustomOrderStatus @default(PENDING)
  estimatedPrice      Float?
  actualPrice         Float?
  files               String[]
  adminNotes          String?
  createdAt           DateTime          @default(now())
  updatedAt           DateTime
  User                User?             @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([status])
  @@index([userId])
}

model StoreSettings {
  id                    String   @id
  shippingBaseRate      Float    @default(50.00)
  shippingPerKgRate     Float    @default(40.00)
  freeShippingThreshold Float    @default(5000.00)
  gstPercent            Float    @default(12.0)
  address               String?
  gstin                 String?
  updatedAt             DateTime
}

enum EventType {
  EXHIBITION
  POPUP
  WORKSHOP
  STUDIO_OPEN
}

enum EventStatus {
  UPCOMING
  ONGOING
  COMPLETED
  CANCELLED
}

enum GalleryCategory {
  PRODUCT
  WORKSHOP
  STUDIO
  EVENT
  PROCESS
  ARTISAN
  CUSTOMER
}

enum InquiryStatus {
  PENDING
  CONTACTED
  QUOTED
  CONVERTED
  ARCHIVED
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum Role {
  CUSTOMER
  ADMIN
}

enum WorkshopStatus {
  UPCOMING
  ACTIVE
  COMPLETED
  CANCELLED
}

enum CustomOrderStatus {
  PENDING
  REVIEWED
  QUOTED
  APPROVED
  IN_PROGRESS
  COMPLETED
  SHIPPED
  CANCELLED
}


model NewsletterSubscriber {
  id        String   @id @default(uuid())
  email     String   @unique
  isActive  Boolean  @default(true)
  source    String   @default("checkout")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}